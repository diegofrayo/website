{"details":{"slug":"my-favorite-music-and-mdx","content":{"en":{"title":"My favorite music and MDX","description":"Introduction to MDX and how to use it with Next.js to create a simple blog."}},"categories":["mdx","next.js","markdown","tailwind-css"],"locales":["en"],"created_at":"2020/11/28","published_at":"2020/12/03","updated_at":"2021/08/14","is_published":true,"sources":[],"assets":{"github":{"name":"website","url":"https://github.com/diegofrayo/website","description":"My personal website","files":{"MDXContent":{"fileName":"src/modules/mdx/client.tsx","url":"https://github.com/diegofrayo/website/blob/master/src/modules/mdx/client.tsx"},"SourceCode":{"fileName":"src/components/shared/SourceCode.tsx","url":"https://github.com/diegofrayo/website/blob/master/src/components/shared/SourceCode.tsx"},"mdx":{"fileName":"src/modules/mdx/client.tsx","url":"https://github.com/diegofrayo/website/blob/master/src/modules/mdx/client.tsx"},"components|blog|slug":{"fileName":"src/modules/pages/blog/BlogPostPage.tsx","url":"https://github.com/diegofrayo/website/blob/master/src/modules/pages/blog/BlogPostPage.tsx"},"pages|blog|slug":{"fileName":"src/pages/blog/[slug].tsx","url":"https://github.com/diegofrayo/website/blob/master/src/pages/blog/[slug].tsx"},"MDXContent-Styles":{"fileName":"src/modules/mdx/styles.module.css","url":"https://github.com/diegofrayo/website/blob/master/src/modules/mdx/styles.module.css"}}},"$sourceCodeFiles":{"1":"export function HelloWorldMDX({ text }: T_Object): T_ReactElement {\r\n\treturn <p className=\"tw-bg-red-200 tw-block tw-p-2 tw-text-red-700\">{text}</p>;\r\n}\r\n","4":"export const getStaticPaths: GetStaticPaths = async function getStaticPaths() {\r\n\tconst data = await loadData<T_RawBlogPostsResponse>({ page: \"blog\" });\r\n\r\n\treturn {\r\n\t\tpaths: Object.values(data).map((post) => {\r\n\t\t\treturn { params: { slug: post.config.slug } };\r\n\t\t}),\r\n\t\tfallback: \"blocking\",\r\n\t};\r\n};\r\n","5":"type T_BlogPostPageProps = {\r\n\tpostDetails: T_BlogPost;\r\n\tpostContent: string;\r\n};\r\n\r\nexport const getStaticProps: GetStaticProps<T_BlogPostPageProps, { slug: string }> = async ({\r\n\tparams,\r\n}) => {\r\n\tconst DEFAULT_LANG = \"en\";\r\n\tconst posts = await loadData<T_RawBlogPostsResponse>({ page: \"blog\" });\r\n\tconst slug = params?.slug || \"\";\r\n\tconst postDetails = { ...posts[slug] };\r\n\r\n\tif (!postDetails) throw new Error(`Invalid post slug: \"${slug}\"`);\r\n\r\n\tconst mdxCompiled = await compile({\r\n\t\tsource: `./src/data/blog/posts/content/${replaceAll(postDetails.config.created_at, \"/\", \"-\")}-${\r\n\t\t\tpostDetails.config.slug\r\n\t\t}.mdx`,\r\n\t});\r\n\r\n\treturn {\r\n\t\tprops: {\r\n\t\t\tpostDetails: {\r\n\t\t\t\t...postDetails,\r\n\t\t\t\tcontent: postDetails.content[DEFAULT_LANG],\r\n\t\t\t},\r\n\t\t\tpostContent: mdxCompiled.code,\r\n\t\t},\r\n\t};\r\n};\r\n","6":"import * as React from \"react\";\r\n\r\nimport { MainLayout, Page } from \"~/components/layout\";\r\nimport { Space } from \"~/components/primitive\";\r\nimport { Callout, ImageWithLink, Playground, SourceCode } from \"~/components/shared\";\r\nimport { MDXContent } from \"~/modules/mdx/client\";\r\nimport { ROUTES } from \"~/modules/routing\";\r\nimport type { T_BlogPost } from \"~/modules/pages/blog/types\";\r\n\r\nimport * as BlogPostsComponents from \"./components/my-favorite-music-and-mdx\";\r\n\r\nexport type T_BlogPostPageProps = {\r\n\tpostDetails: T_BlogPost;\r\n\tpostContent: string;\r\n};\r\n\r\nfunction BlogPostPage({ postDetails, postContent }: T_BlogPostPageProps) {\r\n\treturn (\r\n\t\t<Page\r\n\t\t\tconfig={{\r\n\t\t\t\ttitle: postDetails.content.title,\r\n\t\t\t\tdescription: postDetails.content.description,\r\n\t\t\t\tdisableSEO: postDetails.config.is_published === false,\r\n\t\t\t\tpathname: `${ROUTES.BLOG}/${postDetails.config.slug}`,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<MainLayout title={postDetails.content.title}>\r\n\t\t\t\t<BlogPostDetails postDetails={postDetails} />\r\n\t\t\t\t<Space size={1.5} />\r\n\r\n\t\t\t\t<MDXContent\r\n\t\t\t\t\tcode={postContent}\r\n\t\t\t\t\tcomponents={{\r\n\t\t\t\t\t\tCallout,\r\n\t\t\t\t\t\tImageWithLink,\r\n\t\t\t\t\t\tPlayground,\r\n\t\t\t\t\t\tSourceCode,\r\n\t\t\t\t\t\t...BlogPostsComponents,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tglobals={{\r\n\t\t\t\t\t\tDATA: { post: postDetails },\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t\t<Space size={5} />\r\n\r\n\t\t\t\t<BlogPostSources sources={postDetails.config.sources} />\r\n\t\t\t\t<Space size={12} />\r\n\r\n\t\t\t\t<RateContent />\r\n\t\t\t\t<Space size={1.5} />\r\n\r\n\t\t\t\t<BlogPostActions />\r\n\t\t\t</MainLayout>\r\n\t\t</Page>\r\n\t);\r\n}\r\n\r\nexport default BlogPostPage;\r\n","7":"import * as React from \"react\";\r\nimport { getMDXComponent } from \"mdx-bundler/client\";\r\nimport cn from \"classnames\";\r\n\r\nimport { Link, List, Pre, Space, Text, Code, Block, Title, Image } from \"~/components/primitive\";\r\nimport type { T_TitleProps } from \"~/components/primitive/Title\";\r\nimport type DR from \"@diegofrayo/types\";\r\n\r\nimport styles from \"./styles.module.css\";\r\n\r\ntype T_MDXContentProps = {\r\n\tcode: string;\r\n\tcomponents?: DR.Object;\r\n\tglobals?: DR.Object;\r\n};\r\n\r\nexport function MDXContent({ code, components = {}, globals = {} }: T_MDXContentProps) {\r\n\tconst Component = React.useMemo(() => getMDXComponent(code, globals), [code, globals]);\r\n\r\n\treturn (\r\n\t\t<Block className={cn(styles[\"dr-mdx-content\"])}>\r\n\t\t\t<Component components={{ ...MDXComponents, ...components }} />\r\n\t\t</Block>\r\n\t);\r\n}\r\n","8":"import * as React from \"react\";\r\nimport cn from \"classnames\";\r\n\r\nimport { Block, Code, Icon, InlineText, Link, Pre, Space } from \"~/components/primitive\";\r\nimport v from \"@diegofrayo/v\";\r\n\r\nimport CopyToClipboardPopover from \"./CopyToClipboardPopover\";\r\n\r\nexport type T_SourceCodeProps = {\r\n\tlanguage: \"jsx\" | \"tsx\" | \"css\" | \"typescript\" | \"javascript\" | \"bash\" | \"yaml\" | \"markdown\";\r\n\tcode: string;\r\n\tfileName?: string;\r\n\tsourceURL?: string;\r\n\tclassName?: string;\r\n\theight?: \"100%\" | \"auto\" | number;\r\n};\r\n\r\nfunction SourceCode({\r\n\tlanguage,\r\n\tcode,\r\n\tfileName = \"\",\r\n\tsourceURL = \"\",\r\n\tclassName = \"\",\r\n\theight = \"auto\",\r\n}: T_SourceCodeProps) {\r\n\t// --- VARS ---\r\n\tconst codeTitle = v.isNotEmptyString(fileName)\r\n\t\t? `// ${fileName}`\r\n\t\t: v.isNotEmptyString(sourceURL)\r\n\t\t? `// ${sourceURL.slice(sourceURL.lastIndexOf(\"/\") + 1, sourceURL.length)}`\r\n\t\t: \"\";\r\n\r\n\treturn (\r\n\t\t<Block\r\n\t\t\tclassName={cn(\r\n\t\t\t\t\"dr-source-code tw-flex tw-flex-col tw-rounded-md tw-border dr-border-color-surface-300\",\r\n\t\t\t\tclassName,\r\n\t\t\t)}\r\n\t\t\tstyle={{\r\n\t\t\t\theight,\r\n\t\t\t\tmaxHeight: height === \"auto\" ? 500 : \"none\",\r\n\t\t\t}}\r\n\t\t\tdata-markdown-block\r\n\t\t>\r\n\t\t\t<Block\r\n\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\"tw-flex tw-flex-shrink-0 tw-flex-wrap tw-items-center tw-justify-between tw-rounded-t-md tw-px-4 tw-py-2 tw-pr-2 tw-font-mono tw-text-sm\",\r\n\t\t\t\t)}\r\n\t\t\t>\r\n\t\t\t\t{v.isNotEmptyString(codeTitle) ? (\r\n\t\t\t\t\t<Code className=\"tw-mr-4 tw-flex-1 tw-truncate tw-font-bold\">{codeTitle}</Code>\r\n\t\t\t\t) : null}\r\n\t\t\t\t<InlineText className=\"tw-ml-auto tw-inline-block tw-flex-shrink-0 tw-bg-yellow-300 tw-px-3 tw-py-1 tw-text-xs tw-font-bold tw-text-yellow-700\">\r\n\t\t\t\t\t{language}\r\n\t\t\t\t</InlineText>\r\n\t\t\t</Block>\r\n\r\n\t\t\t<Pre\r\n\t\t\t\tvariant={Pre.variant.HIGHLIGHTED}\r\n\t\t\t\tclassName=\"tw-flex-1 tw-border-y dr-border-color-surface-300\"\r\n\t\t\t>\r\n\t\t\t\t{code}\r\n\t\t\t</Pre>\r\n\r\n\t\t\t<Block className=\"tw-flex tw-flex-shrink-0 tw-flex-col-reverse tw-rounded-b-md tw-px-4 tw-py-2 tw-pr-2 tw-text-sm tw-font-bold tw-text-white sm:tw-flex-row sm:tw-justify-end\">\r\n\t\t\t\t{v.isNotEmptyString(sourceURL) ? (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\tvariant={Link.variant.SIMPLE}\r\n\t\t\t\t\t\t\thref={sourceURL}\r\n\t\t\t\t\t\t\tclassName=\"tw-ml-auto tw-inline-block tw-w-48 tw-text-right sm:tw-ml-0 sm:tw-text-left\"\r\n\t\t\t\t\t\t\tisExternalLink\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\t\ticon={Icon.icon.GITHUB_MONO}\r\n\t\t\t\t\t\t\t\tsize={16}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<InlineText className=\"tw-ml-1 tw-lowercase\">See source code</InlineText>\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t<Space responsive=\"tw-block tw-mb-1 tw-mr-0 sm:tw-inline-block sm:tw-mb-0 sm:tw-mr-6\" />\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t) : null}\r\n\r\n\t\t\t\t<CopyToClipboardPopover\r\n\t\t\t\t\ttextToCopy={code}\r\n\t\t\t\t\tbuttonClassName=\"tw-text-right tw-w-48 tw-ml-auto tw-inline-block\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<Icon icon={Icon.icon.CLIPBOARD} />\r\n\t\t\t\t\t<InlineText className=\"tw-ml-1 tw-lowercase\">Copy to clipboard</InlineText>\r\n\t\t\t\t</CopyToClipboardPopover>\r\n\t\t\t</Block>\r\n\t\t</Block>\r\n\t);\r\n}\r\n\r\nexport default SourceCode;\r\n","7-styles":"/* Spacing: parent components */\r\n.dr-mdx-content\r\n\t> :is(blockquote, hr, ol, p, :global(.dr-pre--styled), ul, a > img, *[data-markdown-block]) {\r\n\t@apply tw-mb-6;\r\n}\r\n\r\n.dr-mdx-content > *:last-child {\r\n\t@apply tw-mb-0;\r\n}\r\n\r\n/* Spacing: nested components */\r\n.dr-mdx-content\r\n\t:is(\r\n\t\tli > p,\r\n\t\tli > :global(.dr-pre--styled),\r\n\t\tli > blockquote,\r\n\t\tli > img,\r\n\t\tblockquote > p,\r\n\t\tli > a > img\r\n\t) {\r\n\t@apply tw-mb-3;\r\n}\r\n\r\n/* Spacing: titles */\r\n.dr-mdx-content > :is(h1, h2, h3, h4) {\r\n\t@apply tw-mt-8;\r\n\t@apply tw-mb-3;\r\n}\r\n\r\n/* Spacing: nested UL lists */\r\n.dr-mdx-content :is(li > ul, li > :global(.dr-pre--styled)) {\r\n\t@apply tw-mt-3;\r\n}\r\n\r\n/* Ordered lists */\r\n.dr-mdx-content ol {\r\n\t@apply tw-pl-9;\r\n\tlist-style-type: decimal;\r\n}\r\n\r\n.dr-mdx-content ol > li {\r\n\t@apply tw-mb-6;\r\n}\r\n\r\n/* Images */\r\n.dr-mdx-content :is(> a > img, li > a > img) {\r\n\t@apply tw-rounded-md;\r\n\tmargin-left: auto;\r\n\tmargin-right: auto;\r\n}\r\n"}}},"content":"export const Components = {\r\n\tPlayground: \"Playground\",\r\n\tMFMAMGitHubRepo: \"MFMAMGitHubRepo\",\r\n\tMFMAMHelloWorldMDX: \"MFMAMGitHubRepo\",\r\n\tMFMAMSpotifyPlaylist: \"MFMAMSpotifyPlaylist\",\r\n};\r\n\r\n**Spotify** just created a playlist with the most listened songs by me during this 2020, so, I took this opportunity to write a tutorial about [MDX](https://mdxjs.com/) and [Next.js](https://nextjs.org).\r\n\r\n> **MDX** is a **Markdown** language enhancement, making it more powerful and customizable, because **MDX** allows rendering **React components** inside of **Markdown** files.\r\n\r\nThis tutorial was written using **MDX**, so, below, you can see an example of a **React component** rendered in this post.\r\n\r\n<Playground\r\n\tlanguage=\"tsx\"\r\n\tPreview={() => {\r\n\t\treturn <MFMAMHelloWorldMDX text=\"I'm a React component that uses Tailwind CSS for styling\" />;\r\n\t}}\r\n\tsourceCode={DATA.post.assets.$sourceCodeFiles[\"1\"]}\r\n\theight={300}\r\n/>\r\n\r\n## Setting up **Next.js** and MDX\r\n\r\nI built this website using **Next.js**, I'm going to talk about how I configured **MDX** to create the blog section. To accomplish it, this [article](https://sergiodxa.com/articles/using-mdx-with-remote-content) posted by [Sergio Xalambr√≠](https://twitter.com/sergiodxa) was helpful for me.\r\n\r\nFirst of all, I configured **MDX** with **Next.js** and in this [link](https://mdxjs.com/getting-started/next) you can check out the instructions, it is really easy to complete it.\r\n\r\nThen, I installed the [next-mdx-remote](https://github.com/hashicorp/next-mdx-remote) package. This package allows rendering **MDX** files that can be hosted on a remote location, for example, a **CMS**, a **CDN**, a **database** or anywhere. There are other reasons for which it is useful to use this package, in this [section of its GitHub repository](https://github.com/hashicorp/next-mdx-remote#background--theory) you can dig deep in the problems that **next-mdx-remote** solves.\r\n\r\nNow, I'm going to explain how to use **next-mdx-remote** for rendering a blog post in a **Next.js** page depending on a URL param.\r\n\r\nFirst, I created the `getStaticPaths` function where the `paths` property is an array of slugs of all my blog posts that I want to **pre-render**.\r\n\r\n<SourceCode\r\n\tcode={DATA.post.assets.$sourceCodeFiles[\"4\"]}\r\n\tsourceURL={DATA.post.assets.github.files[\"pages|blog|slug\"].url}\r\n/>\r\n\r\n> I chose the **static-site generation** approach because I don't have a lot of pages, probably less than 20 and its content does not change often. I recommend reading more about this topic in this [Next.js docs page](https://nextjs.org/docs/basic-features/data-fetching), its explanation is very clear.\r\n\r\nNow, inside of the `getStaticProps` function, the **MDX** content of all blog posts is readed. This function only executes at build time, I mean, on the server side. At the moment I store all my blog posts **MDX** files inside of this website repository. In the future, I could store them on a **CMS**, for example.\r\n\r\n<SourceCode\r\n\tcode={DATA.post.assets.$sourceCodeFiles[\"5\"]}\r\n\tsourceURL={DATA.post.assets.github.files[\"pages|blog|slug\"].url}\r\n/>\r\n\r\n> **Problem:** I can't import components or variables directly inside of **MDX** files when I use **next-mdx-remote** to compile them. In this [link](https://github.com/hashicorp/next-mdx-remote#caveats) you can read more about this.\r\n\r\n> **Solution:** I had to pass a config object when I invoked the `serialize` function. The `scope` property is an object that contains the **data (variables)** that I need to use inside of my **MDX** files.\r\n\r\nFinally, this is the component that renders a blog post:\r\n\r\n<SourceCode\r\n\tcode={DATA.post.assets.$sourceCodeFiles[\"6\"]}\r\n\tsourceURL={DATA.post.assets.github.files[\"components|blog|slug\"].url}\r\n/>\r\n\r\nIn regards to the **MDX** components styling, at the beginning I used this [Tailwind CSS plugin](https://tailwindcss.com/docs/typography-plugin), but then, I decided don't use it anymore and I built a component with my own styles.\r\n\r\n<SourceCode\r\n\tcode={DATA.post.assets.$sourceCodeFiles[\"7\"]}\r\n\tsourceURL={DATA.post.assets.github.files[\"MDXContent\"].url}\r\n/>\r\n<SourceCode\r\n\tcode={DATA.post.assets.$sourceCodeFiles[\"7-styles\"]}\r\n\tsourceURL={DATA.post.assets.github.files[\"MDXContent-Styles\"].url}\r\n/>\r\n\r\n> `@apply` directive allows me to use **Tailwind CSS** classes within my `css.modules` files.\r\n\r\nI used [prism-react-renderer](https://github.com/FormidableLabs/prism-react-renderer) for code syntax highlighting:\r\n\r\n<SourceCode\r\n\tcode={DATA.post.assets.$sourceCodeFiles[\"8\"]}\r\n\tsourceURL={DATA.post.assets.github.files[\"SourceCode\"].url}\r\n/>\r\n\r\n## Final words\r\n\r\nI share the URL of this repository in case of you want to see more details about my website and my blog section were implemented. Allright, this is all, thanks for reading.\r\n\r\n<MFMAMGitHubRepo\r\n\tname={DATA.post.assets.github.name}\r\n\turl={DATA.post.assets.github.url}\r\n\tdescription={DATA.post.assets.github.description}\r\n/>\r\n\r\nI share the **Spotify** playlist for which I wrote down this blog post:\r\n\r\n<MFMAMSpotifyPlaylist />\r\n"}