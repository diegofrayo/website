**Spotify** acaba de hacer una playlist con mi TOP de canciones m√°s escuchadas en este 2020, as√≠ que aprovech√© para hacer un post sobre **MDX**.

> **MDX** es una extensi√≥n del lenguaje **Markdown**, haciendolo mucho m√°s potente y personalizable, ya que permite usar y renderizar **componentes React** dentro de archivos **Markdown** ü§Ø.

A continuaci√≥n, un ejemplo de un **componente de React** renderizado en este archivo **MDX**.

<HelloWorldMDX text="Hola, soy un componente React que usa Tailwind CSS para sus estilos" />

<Code
  language="jsx"
  sourceURL={github.website.files.MDXComponents}
  code={`export function HelloWorldMDX({ text }: Record<string, any>): any {
  return (
    <p className="tw-bg-red-200 tw-block tw-p-2 tw-text-red-700 tw-rounded-md">{text}</p>
  );
}`}
/>

<br />

## Configurando Next.js y MDX

Este sitio web lo constru√≠ usando **Next.js**, voy a hablar acerca de como configur√© **MDX** para crear la secci√≥n del blog. Para lograr esto, me fue de gran ayuda este [art√≠culo](https://sergiodxa.com/articles/using-mdx-with-remote-content) publicado por [Sergio Xalambr√≠.](https://twitter.com/sergiodxa)

Entonces, primero configur√© **MDX** con **Next.js**. Aqu√≠ est√°n las [instrucciones](https://mdxjs.com/getting-started/next), realmente es muy f√°cil lograrlo.

Despu√©s, instal√© el paquete [next-mdx-remote](https://github.com/hashicorp/next-mdx-remote). Este paquete permite renderizar archivos **MDX** que pueden estar alojados en un sitio diferente al proyecto, por ejemplo un **CMS**, un **CDN**, una **base de datos** o cualquier otro lugar. Hay otras razones m√°s por las cuales es √∫til usar este paquete, en esta [secci√≥n de su repositorio de Github](https://github.com/hashicorp/next-mdx-remote#background--theory) puedes conocer m√°s acerca de los problemas que soluciona **next-mdx-remote**.

Ahora, explicar√© algunos de los pasos que realic√© para usar **next-mdx-remote** en la p√°gina de **Next.js** de mi sitio web que se encarga de cargar el contenido **MDX** de un blog post de acuerdo a un par√°metro de URL (`/blog/[slug]`).

Primero, import√© algunas funciones de **next-mdx-remote**.

<Code
  language="javascript"
  sourceURL={github.website.files["[slug]"]}
  code={`import hydrate from "next-mdx-remote/hydrate";
import renderToString from "next-mdx-remote/render-to-string";`}
/>

Despu√©s, import√© los **componentes React** y las **variables** que se usar√°n dentro de los archivos **MDX**.

<Code
  language="javascript"
  sourceURL={github.website.files.mdx}
  code={`import { MDXComponentsConfig, MDXScope } from "~/utils/mdx";`}
/>

Configur√© la funci√≥n `getStaticPaths` en donde la propiedad `paths` es un arreglo con los slugs de todos mis blog posts que voy a **pre-renderizar** como p√°ginas. El listado de todos mis blog posts est√°n definidos en un archivo <Link href={github.website.files.posts}>JSON</Link> dentro del proyecto, pero esta informaci√≥n se podr√≠a leer de una **base de datos**, un **CMS**, una **API**, etc.

<Code
  language="typescript"
  sourceURL={github.website.files["[slug]"]}
  code={`export async function getStaticPaths(): Promise<Record<string, any>> {
  return {
    paths: Object.keys(BlogPosts).map(slug => {
      return { params: { slug } };
    }),
    fallback: false,
  };
}
// output: { paths: [{ params: { slug: "my-favorite-music-and-mdx" } }, ...more blog posts], fallback: false }`}
/>

> La razon de configurar `fallback: false` es porque estoy usando **Static Generation**, por lo tanto todas las p√°ginas de este sitio web son **pre-renderizadas** en **tiempo de compilaci√≥n**, esto trae beneficios de rendimiento y velocidad de carga. Eleg√≠ **Static Generation** porque tengo muy pocas p√°ginas y blog posts en este momento, en un futuro cuando este sitio web crezca, usar√© otra estrategia m√°s eficiente y que mejor se adapte a mi situaci√≥n. Les recomiendo leer la [documentaci√≥n de Vercel](https://nextjs.org/docs/basic-features/data-fetching) acerca de este tema, es muy clara su explicaci√≥n.

Ahora, en la funci√≥n `getStaticProps` se lee el contenido **MDX** de cada blog post. Esta funci√≥n se ejecuta solo en el servidor. Por el momento tengo el contenido de los blog posts dentro de mi proyecto, en un futuro podr√≠a alojarlos en un **CMS**, por ejemplo.

<Code
  sourceURL={github.website.files["[slug]"]}
  language="typescript"
  code={`export async function getStaticProps({
  params,
}: Record<string, any>): Promise<Record<string, any>> {
  const post = BlogPosts[params.slug];
  const note = fs.readFileSync(
    \`\${process.cwd()}/src/data/blog/posts/\${DEFAULT_LOCALE}/\${post.date}-\${
      post.slug
    }.mdx\`,
    "utf8",
  );
  const content = await renderToString(note, {
    components: MDXComponentsConfig,
    scope: MDXScope,
  });
  return { props: { post, content } };
}`}
/>

> El segundo par√°metro de la funci√≥n `renderToString` es un objeto de configuraci√≥n. La propiedad `components` debe ser un objeto que contenga todos los **componentes React** que se usar√°n en los archivos **MDX**. La propiedad `scope` es muy √∫til, es un objeto en donde se puede guardar **variables** que se usar√°n en los archivos **MDX**.

Por √∫ltimo, este es el componente que renderiza un blog post.

<Code
  sourceURL={github.website.files["[slug]"]}
  language="jsx"
  code={`function BlogPostPage({ post, content }: Record<string, any>): any {
  const mdxContent = hydrate(content, { components: MDXComponentsConfig });
  return (
    <Page>
      <MainLayout
        breadcumb={[
          { text: SiteTexts.layout.breadcumb.home, url: Routes.HOME },
          { text: SiteTexts.layout.breadcumb.blog, url: Routes.BLOG() },
          {
            text: post[DEFAULT_LOCALE].title,
            url: Routes.BLOG(post.slug),
          },
        ]}
        title={post[DEFAULT_LOCALE].title}
        blogMetadata={{
          author: "@diegofrayo",
          date: post.date,
          sourceURL: \`\${post.date}-\${post.slug}\`,
        }}
      >
        <MDXContent content={mdxContent} />
      </MainLayout>
    </Page>
  );
}`}
/>

> **Importante:** Es necesario que el valor de la propiedad `components` sea igual en `hydrate(content, { components: MDXComponentsConfig });` como en `await renderToString(content, { components: MDXComponentsConfig });`

Y bueno, esto fue todo, aqu√≠ comparto la **URL** del repositorio de este sitio web en **Github**.

<GithubRepo
  name={github.website.name}
  url={github.website.url}
  description={github.website.description}
/>

---

Ahora voy a hablar acerca de la otra parte de este blog post, osea, la **m√∫sica** que m√°s escuch√© este a√±o. Mi idea inicial fue escribir el contenido de los blog posts usando solamente **Markdown**, pero gracias a **MDX** pude combinar **Markdown** con **React** y de esta forma pude insertar un **Widget HTML** para mostrar la playlist de canciones que **Spotify** hizo para m√≠.

<SpotifyPlaylist />

Despu√©s de ver esta playlist observo que.

1. **Par mil** es una de mis canciones favoritas y que m√°s disfruto tocar en la guitarra
1. Este a√±o descubr√≠ mucha m√∫sica de **Pedro Aznar**, me parece un m√∫sico incre√≠ble
1. **Parque Acu√°tico** me parece una canci√≥n muy cool y la escuch√© mucho en la cuarentena
1. Me asombra no ver canciones del album **Artaud** de **Spinetta** en el TOP 10 de esta playlist, porque escuch√© muchas veces ese album y es uno de mis favoritos
1. Definitivamente me gusta mucho la m√∫sica **Argentina**, es la que m√°s escucho en mi d√≠a a d√≠a

Si llegaste hasta aqu√≠, gracias üòÉ
