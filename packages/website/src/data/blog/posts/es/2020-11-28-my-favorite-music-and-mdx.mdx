**Spotify** acaba de hacer una playlist con mi TOP de canciones m√°s escuchadas en este 2020, as√≠ que aprovech√© para hacer un post sobre [MDX](https://mdxjs.com/).

> **MDX** es una extensi√≥n del lenguaje **Markdown**, haciendolo mucho m√°s potente y personalizable, ya que permite usar y renderizar **componentes React** dentro de archivos **Markdown** ü§Ø.

A continuaci√≥n, un ejemplo de un **componente de React** renderizado en este archivo **MDX**.

<HelloWorldMDX text="Hola, soy un componente React que usa Tailwind CSS para sus estilos" />

<Code
  language="jsx"
  sourceURL={DATA.github.monorepo.website.files.MDXComponents}
  code={`export function HelloWorldMDX({ text }: Record<string, any>): any {
  return (
    <p className="tw-bg-red-200 tw-block tw-p-2 tw-text-red-700 tw-rounded-md">{text}</p>
  );
}`}
/>

<br />

## Configurando Next.js y MDX

Este sitio web lo constru√≠ usando **Next.js**, voy a hablar acerca de como configur√© **MDX** para crear la secci√≥n del blog. Para lograr esto, me fue de gran ayuda este [art√≠culo](https://sergiodxa.com/articles/using-mdx-with-remote-content) publicado por [Sergio Xalambr√≠](https://twitter.com/sergiodxa).

Entonces, primero configur√© **MDX** con **Next.js**. Aqu√≠ est√°n las [instrucciones](https://mdxjs.com/getting-started/next), realmente es muy f√°cil lograrlo.

Despu√©s, instal√© el paquete [next-mdx-remote](https://github.com/hashicorp/next-mdx-remote). Este paquete permite renderizar archivos **MDX** que pueden estar alojados en un sitio diferente al proyecto, por ejemplo un **CMS**, un **CDN**, una **base de datos** o cualquier otro lugar. Hay otras razones m√°s por las cuales es √∫til usar este paquete, en esta [secci√≥n de su repositorio de Github](https://github.com/hashicorp/next-mdx-remote#background--theory) puedes conocer m√°s acerca de los problemas que soluciona **next-mdx-remote**.

Ahora, explicar√© algunos de los pasos que realic√© para usar **next-mdx-remote** en la p√°gina de **Next.js** de mi sitio web que se encarga de cargar el contenido **MDX** de una publicaci√≥n de acuerdo a un par√°metro de URL (`/blog/[slug]`).

Primero, import√© algunas funciones de **next-mdx-remote**.

<Code
  language="javascript"
  sourceURL={DATA.github.monorepo.website.files["[slug]"]}
  code={`import hydrate from "next-mdx-remote/hydrate";
import renderToString from "next-mdx-remote/render-to-string";`}
/>

Despu√©s, import√© los **componentes React** y las **variables** que se usar√°n dentro de los archivos **MDX**.

<Code
  language="javascript"
  sourceURL={DATA.github.monorepo.website.files.mdx}
  code={`import { MDXComponentsConfig, MDXScope } from "~/utils/mdx";`}
/>

Configur√© la funci√≥n `getStaticPaths` en donde la propiedad `paths` es un arreglo con los slugs de todos mis publicaciones que voy a **pre-renderizar** como p√°ginas. El listado de todos mis publicaciones est√°n definidos en un archivo <Link href={DATA.github.monorepo.website.files.posts}>JSON</Link> dentro del proyecto, pero esta informaci√≥n se podr√≠a leer de una **base de datos**, un **CMS**, una **API**, etc.

<Code
  language="typescript"
  sourceURL={DATA.github.monorepo.website.files["[slug]"]}
  code={`export async function getStaticPaths(): Promise<Record<string, any>> {
  return {
    paths: Object.keys(BlogPosts).map(slug => {
      return { params: { slug } };
    }),
    fallback: false,
  };
}
// output: { paths: [{ params: { slug: "my-favorite-music-and-mdx" } }, ...more blog posts], fallback: false }`}
/>

> La razon de configurar `fallback: false` es porque estoy usando **Static Generation**, por lo tanto todas las p√°ginas de este sitio web son **pre-renderizadas** en **tiempo de compilaci√≥n**, esto trae beneficios de rendimiento y velocidad de carga. Eleg√≠ **Static Generation** porque tengo muy pocas p√°ginas y publicaciones en este momento, en un futuro cuando este sitio web crezca, usar√© otra estrategia m√°s eficiente y que mejor se adapte a mi situaci√≥n. Les recomiendo leer la [documentaci√≥n de Vercel](https://nextjs.org/docs/basic-features/data-fetching) acerca de este tema, es muy clara su explicaci√≥n.

Ahora, en la funci√≥n `getStaticProps` se lee el contenido **MDX** de cada publicaci√≥n. Esta funci√≥n se ejecuta solo en el servidor. Por el momento tengo el contenido de las publicaciones dentro de mi proyecto, en un futuro podr√≠a alojarlos en un **CMS**, por ejemplo.

<Code
  sourceURL={DATA.github.monorepo.website.files["[slug]"]}
  language="typescript"
  code={`export async function getStaticProps({
  params,
}: Record<string, any>): Promise<Record<string, any>> {
  const post = BlogPosts[params.slug];
  const note = fs.readFileSync(
    \`\${process.cwd()}/src/data/blog/posts/\${CURRENT_LOCALE}/\${post.published_at}-\${
      post.slug
    }.mdx\`,
    "utf8",
  );
  const content = await renderToString(note, {
    components: MDXComponentsConfig,
    scope: MDXScope,
  });
  return { props: { post, content } };
}`}
/>

> **Problema:** Al usar **next-mdx-remote**, no puedo importar componentes o variables dentro de los archivos **MDX** usando `import`. En este [link](https://github.com/hashicorp/next-mdx-remote#caveats) puedes leer m√°s acerca de esto.

> **Soluci√≥n:** Tuve que pasar un objeto de configuraci√≥n cuando invoqu√© la funci√≥n `renderToString`. La propiedad `components` debe ser un objeto que contenga todos los **componentes React** que se usar√°n en los archivos **MDX**. La propiedad `scope` es un objeto en donde se puede guardar **variables** que se usar√°n en los archivos **MDX**.

Por √∫ltimo, este es el componente que renderiza una publicaci√≥n.

<Code
  sourceURL={DATA.github.monorepo.website.files["[slug]"]}
  language="jsx"
  code={`function BlogPostPage({ post, content }: Record<string, any>): any {
  const mdxContent = hydrate(content, { components: MDXComponentsConfig });
  return (
    <Page metadata={{ title: post[CURRENT_LOCALE].title }}>
      <MainLayout
        breadcumb={[
          { text: SiteTexts.layout.current_locale.breadcumb.home, url: Routes.HOME },
          { text: SiteTexts.layout.current_locale.breadcumb.blog, url: Routes.BLOG() },
          {
            text: post[CURRENT_LOCALE].title,
            url: Routes.BLOG(post.slug),
          },
        ]}
        title={post[CURRENT_LOCALE].title}
        blogMetadata={{
          author: "@diegofrayo",
          slug: post.slug,
          publishedAt: post.published_at,
        }}
      >
        <MDXContent content={mdxContent} />
      </MainLayout>
    </Page>
  );
}`}
/>

> **Importante:** Es necesario que el valor de la propiedad `components` sea igual en `hydrate(content, { components: MDXComponentsConfig });` como en `await renderToString(content, { components: MDXComponentsConfig });`.

Para manejar los estilos **CSS** del contenido compilado de los archivos **MDX**, us√© al inicio este [plugin](https://tailwindcss.com/docs/typography-plugin) de [Tailwind CSS](https://tailwindcss.com), pero despu√©s lo dej√© de usar y decid√≠ construir un componente con mis propios estilos.

<Code
  sourceURL={DATA.github.monorepo.website.files.MDXContent}
  language="jsx"
  code={`import * as React from "react";
import ClipboardJS from "clipboard";
import { useDidMount } from "~/hooks";
function MDXContent({ content }: Record<string, any>): any {
  useDidMount(() => {
    new ClipboardJS(".clipboard");
  });
  return (
    <article className="mdx-content">
      {content}
      <style jsx>{\`
        :global(.mdx-content) > :global(p),
        :global(.mdx-content) :global(pre),
        :global(.mdx-content) :global(blockquote),
        :global(.mdx-content) :global(img),
        :global(.mdx-content) :global(hr),
        :global(.mdx-content) :global(ol) {
          @apply tw-mt-3;
          @apply tw-mb-6;
        }
        :global(.mdx-content) :global(ol) {
          @apply tw-pl-6;
          list-style-type: decimal;
        }
        :global(.mdx-content) :global(pre) {
          @apply tw-bg-gray-800;
          @apply tw-p-4;
          @apply tw-rounded-md;
          @apply tw-text-base;
          @apply tw-text-gray-300;
          max-width: 100%;
          overflow-x: auto;
          word-break: keep-all;
        }
        :global(.mdx-content) :global(blockquote) {
          @apply tw-border-black;
          @apply tw-border-l-4;
          @apply tw-pl-4;
          color: black;
          font-style: italic;
        }
        :global(.mdx-content) :global(p) :global(code) {
          @apply tw-text-red-700;
          @apply tw-text-base;
        }
        :global(.mdx-content) :global(p) :global(code):after {
          content: "\`";
        }
        :global(.mdx-content) :global(p) :global(code):before {
          content: "\`";
        }
        :global(.mdx-content) :global(h1),
        :global(.mdx-content) :global(h2),
        :global(.mdx-content) :global(h3),
        :global(.mdx-content) :global(h4) {
          @apply tw-mb-3;
        }
        :global(.mdx-content) :global(h1) {
          @apply tw-text-3xl;
        }
        :global(.mdx-content) :global(h2) {
          @apply tw-text-2xl;
        }
        :global(.mdx-content) :global(h3) {
          @apply tw-text-xl;
        }
        :global(.mdx-content) :global(h4) {
          @apply tw-text-lg;
        }
      \`}</style>
    </article>
  );
}
export default MDXContent;`}
/>

> La directiva `@apply` me permite usar los estilos de **Tailwind CSS** dentro de mis declaraciones de estilos que construyo usando [styled-jsx](https://github.com/vercel/styled-jsx).

El resaltado de s√≠ntaxis de c√≥digo fuente lo hice con [prism-react-renderer](https://github.com/FormidableLabs/prism-react-renderer).

<Code
  sourceURL={DATA.github.monorepo.website.files.MDXComponents}
  language="jsx"
  code={`import Highlight, { defaultProps } from "prism-react-renderer";
import dracula from "prism-react-renderer/themes/dracula";
export function Code({ language, fileName, code, sourceURL }: Record<string, any>): any {
  const SiteTexts = getSiteTexts({ page: Routes.BLOG() });
  return (
    <div className="root tw-mb-6">
      {fileName ||
        (sourceURL && (
          <code className="tw-text-sm tw-mb-2 tw-font-bold">
            {\`// \${sourceURL.slice(sourceURL.lastIndexOf("/") + 1, sourceURL.length)}\`}
          </code>
        ))}
      <Highlight {...defaultProps} code={code} language={language} theme={dracula}>
        {({ className, style, tokens, getLineProps, getTokenProps }) => {
          return (
            <pre className={className} style={style}>
              {tokens.map((line, i) => {
                return (
                  <Line key={i} {...getLineProps({ line, key: i })}>
                    <LineNo>{i + 1}</LineNo>
                    <LineContent>
                      {line.map((token, key) => {
                        return <span key={key} {...getTokenProps({ token, key })} />;
                      })}
                    </LineContent>
                  </Line>
                );
              })}
            </pre>
          );
        }}
      </Highlight>
      <div className="tw-text-right">
        {sourceURL && (
          <Link className="tw-block sm:tw-inline-block sm:tw-mr-4" href={sourceURL}>
            <Image
              src="/static/images/icons/github.svg"
              alt="Github icon"
              className="tw-h-3 tw-w-3 tw-inline-block tw-align-middle tw-mr-1"
            />
            <span className="tw-inline-block tw-text-sm">
              {SiteTexts.page.current_locale.see_source_code}
            </span>
          </Link>
        )}
        <Link
          data-clipboard-text={code}
          className="clipboard tw-block sm:tw-inline-block tw-text-sm  tw-mt-1 sm:tw-mt-0 tw-no-underline"
          role="button"
        >
          {SiteTexts.page.current_locale.copy_to_clipboard}
        </Link>
      </div>
      <style jsx>{\`
        .root pre,
        .root img {
          @apply tw-my-0;
        }
      \`}</style>
    </div>
  );
}
const Line = twcss.div\`tw-table-row\`;
const LineNo = twcss.span\`tw-table-cell tw-text-right tw-pr-4 tw-opacity-50 tw-select-none\`;
const LineContent = twcss.span\`tw-table-cell\`;`}
/>

## Conclusi√≥n

Y bueno, esto fue todo, aqu√≠ comparto la URL del repositorio por si quieres ver con m√°s detalle la implementaci√≥n de este sitio web. Espero que esta publicaci√≥n te sirva para iniciar a trabajar con **MDX**.

<GithubRepo
  name={DATA.github.monorepo.website.name}
  url={DATA.github.monorepo.website.url}
  description={DATA.github.monorepo.website.description}
/>

---

# Bonus üòÅ

No puedo terminar sin hablar acerca de la otra parte importante de esta publicaci√≥n, osea, la m√∫sica que m√°s escuch√© este a√±o. Mi idea inicial fue escribir el contenido de las publicaciones usando solamente **Markdown**, pero gracias a **MDX** pude combinar **Markdown** con **React** y de esta forma pude insertar un **Widget HTML** para mostrar la playlist de canciones que **Spotify** hizo para m√≠.

<SpotifyPlaylist />

Despu√©s de ver esta playlist me doy cuenta que:

1. [Par mil](https://www.youtube.com/watch?v=Gd37vIRhqSA) es una de mis canciones favoritas y que m√°s disfruto tocar en la guitarra
1. Me gusta mucho [Divididos](https://www.youtube.com/watch?v=7OlzxfSKjtI) y especialmente sus canciones de folclore
1. Este a√±o descubr√≠ mucha m√∫sica de [Pedro Aznar](https://www.youtube.com/watch?v=MDSxcA389DE), me parece un m√∫sico incre√≠ble
1. [Parque Acu√°tico](https://www.youtube.com/watch?v=Ffkl2rOQEMg) me parece una canci√≥n muy buena y la escuch√© mucho en la cuarentena
1. Me asombra no ver canciones del album [Artaud](https://www.youtube.com/watch?v=Tk23kQRFWcw&list=PLL0BXIloA_5y3uX2UO0ktpQtUcuc2zGj-) de [Spinetta](https://www.youtube.com/watch?v=hEL2AgzRmjc) en el TOP 10 de esta playlist, porque escuch√© muchas veces ese album y es uno de mis favoritos
1. Descubr√≠ a [LosPetitFellas](https://www.youtube.com/watch?v=u9zWGJ-xNlE), esta [canci√≥n](https://www.youtube.com/watch?v=iX2kyzuJ4ck) es una delicia
1. Definitivamente me gusta mucho la m√∫sica de [Argentina](https://www.youtube.com/watch?v=7YIkurDaHpc), es la que m√°s escucho en mi d√≠a a d√≠a

Hasta la pr√≥xima ‚úåÔ∏è
